cat ${HOME}/NYPD_Complaint_Data_Current__Year_To_Date_.tsv | clickhouse-local --table='input' --input-format='TSVWithNames' \
  --query "
WITH (CMPLNT_FR_DT || ' ' || CMPLNT_FR_TM) AS complaint_start,
     (CMPLNT_TO_DT || ' ' || CMPLNT_TO_TM) AS complaint_end
    SELECT
CMPLNT_NUM::UInt32 AS complaint_number,
ADDR_PCT_CD::UInt8 AS precinct,
BORO_NM::LowCardinality(String) AS borough,
replaceRegexpOne(complaint_start, '(\\d{2})/(\\d{2})/(\\d{4})', '\\3/\\1/\\2')::DateTime64(0) AS complaint_time,
replaceRegexpOne(complaint_start, '(\\d{2})/(\\d{2})/(\\d{4})', '\\3/\\1/\\2')::DateTime64(0) AS resolution_time,
CRM_ATPT_CPTD_CD AS was_crime_completed,
HADEVELOPT AS housing_authority_development,
HOUSING_PSA::UInt32 AS housing_level_code,
JURISDICTION_CODE::UInt8 AS jurisdiction_code, 
JURIS_DESC::LowCardinality(String) AS jurisdiction,
KY_CD::UInt8 AS offense_code,
LAW_CAT_CD::LowCardinality(String) AS offense_level,
LOC_OF_OCCUR_DESC::LowCardinality(String) AS location_descriptor,
OFNS_DESC AS offense_description, 
PARKS_NM::LowCardinality(String) AS park_name,
PATROL_BORO::LowCardinality(String) AS patrol_borough,
PD_CD::UInt16,
PD_DESC,
PREM_TYP_DESC::LowCardinality(String) AS location_type,
toDate(parseDateTimeBestEffort(RPT_DT)) AS date_reported,
STATION_NAME::LowCardinality(String) AS transit_station,
SUSP_AGE_GROUP::LowCardinality(String) AS suspect_age_group,
 SUSP_RACE::LowCardinality(String) AS suspect_race,
SUSP_SEX::LowCardinality(String) AS suspect_sex,
TRANSIT_DISTRICT::UInt8 AS transit_district,
VIC_AGE_GROUP::LowCardinality(String) AS victim_age_group,   
VIC_RACE::LowCardinality(String) AS victim_race,
VIC_SEX::LowCardinality(String) AS victim_sex,
X_COORD_CD::UInt32 AS NY_x_coordinate,
Y_COORD_CD::UInt32 AS NY_y_coordinate,
Latitude,
Longitude
    FROM input" \
  | clickhouse-client --query='INSERT INTO NYPD_Complaint FORMAT TSV'

