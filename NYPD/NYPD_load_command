cat /home/droscign/Downloads/NYPD_Complaint_Data_Current__Year_To_Date_.tsv \
 | clickhouse-local \
  --table='input' \
  --input-format='TSVWithNames' \
  --structure="
    CMPLNT_NUM Int32,
    ADDR_PCT_CD Int32,
    BORO_NM String,
    CMPLNT_FR_DT String,
    CMPLNT_FR_TM String,
    CMPLNT_TO_DT String,
    CMPLNT_TO_TM String,
    CRM_ATPT_CPTD_CD String,
    HADEVELOPT String,
    HOUSING_PSA Int32,
    JURISDICTION_CODE Int32,
    JURIS_DESC String,
    KY_CD Int32,
    LAW_CAT_CD String,
    LOC_OF_OCCUR_DESC String,
    OFNS_DESC String,
    PARKS_NM String,
    PATROL_BORO String,
    PD_CD Int32,
    PD_DESC String,
    PREM_TYP_DESC String,
    RPT_DT String,
    STATION_NAME String,
    SUSP_AGE_GROUP String,
    SUSP_RACE String,
    SUSP_SEX String,
    TRANSIT_DISTRICT Int32,
    VIC_AGE_GROUP String,
    VIC_RACE String,
    VIC_SEX String,
    X_COORD_CD Int32,
    Y_COORD_CD Int32,
    Latitude Float64,
    Longitude Float64
" --query "
    WITH arrayStringConcat([CMPLNT_FR_DT, CMPLNT_FR_TM], ' ') AS FROM_TM,
    arrayStringConcat([CMPLNT_TO_DT, CMPLNT_TO_TM], ' ') AS TO_TM
    SELECT
        CMPLNT_NUM,
        ADDR_PCT_CD,
        BORO_NM,
	      toDateTime(parseDateTimeBestEffort(FROM_TM)) CMPLNT_FR_DATETIME,
	      toDateTime(parseDateTimeBestEffortOrNull(CAST(TO_TM as String))) CMPLNT_TO_DATETIME,
        CRM_ATPT_CPTD_CD,
        HADEVELOPT,
        HOUSING_PSA,
        JURISDICTION_CODE,
        JURIS_DESC,
        KY_CD,
        LAW_CAT_CD,
        LOC_OF_OCCUR_DESC,
        OFNS_DESC,
        PARKS_NM,
        PATROL_BORO,
        PD_CD,
        PD_DESC,
        PREM_TYP_DESC,
	toDate(parseDateTimeBestEffort(RPT_DT)) RPT_DT,
        STATION_NAME,
        SUSP_AGE_GROUP,
        SUSP_RACE,
        SUSP_SEX,
        TRANSIT_DISTRICT,
        VIC_AGE_GROUP,
        VIC_RACE,
        VIC_SEX,
        X_COORD_CD,
        Y_COORD_CD,
        Latitude,
        Longitude
    FROM input" --date_time_input_format best_effort \
  --input_format_skip_unknown_fields true \
  --format=Native | clickhouse-client --password \
  --query='INSERT INTO NYPD_Complaint FORMAT Native'

