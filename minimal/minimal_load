cat minimal.tsv \
 | clickhouse-local \
  --table='input' \
  --input-format='TSVWithNames' \
  --query "
    WITH arrayStringConcat([CMPLNT_FR_DT, CMPLNT_FR_TM], ' ') AS FROM_TM,
    arrayStringConcat([CMPLNT_TO_DT, CMPLNT_TO_TM], ' ') AS TO_TM
    SELECT
        cast (CMPLNT_NUM as Int32) as CMPLNT_NUM,
        cast (ADDR_PCT_CD as Int32) as ADDR_PCT_CD,
        cast (BORO_NM as String) as BORO_NM,
	toDateTime(parseDateTimeBestEffort(FROM_TM)) AS CMPLNT_FR_DATETIME,
	toDateTime(parseDateTimeBestEffortOrNull(CAST(TO_TM as String))) AS CMPLNT_TO_DATETIME
    FROM input" --date_time_input_format best_effort \
  --format=Native | clickhouse-client --password \
  --query='INSERT INTO minimal FORMAT Native'

