cat minimal.tsv \
 | clickhouse-local \
  --table='input' \
  --input-format='TSVWithNames' \
  --query "
    WITH arrayStringConcat([CMPLNT_FR_DT, CMPLNT_FR_TM], ' ') AS FROM_TM,
    arrayStringConcat([CMPLNT_TO_DT, CMPLNT_TO_TM], ' ') AS TO_TM
    SELECT
        CMPLNT_NUM::UInt32 as complaint_number,
        ADDR_PCT_CD::UInt8 as precinct,
        BORO_NM as borough,
	toDateTime(parseDateTimeBestEffort(FROM_TM)) AS complaint_time,
	toDateTime(parseDateTimeBestEffortOrNull(CAST(TO_TM as String))) AS resolution_time
    FROM input" \
  | clickhouse-client --password \
  --query='INSERT INTO minimal FORMAT TSV'

